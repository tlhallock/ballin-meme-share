
CREATE TABLE IF NOT EXISTS FILE (
   F_ID INTEGER PRIMARY KEY     AUTOINCREMENT,
   NAME           TEXT    NOT NULL,
   SIZE           INT     NOT NULL,
   CHKSUM         CHAR(50),
   PATH           INT NOT NULL,
   ROOT           INT NOT NULL,
   
   FOREIGN KEY(PATH) REFERENCES PATH(P_ID),
   FOREIGN KEY(ROOT) REFERENCES PATH(R_ID),
   
   UNIQUE(NAME, PATH, ROOT)
);

CREATE TABLE IF NOT EXISTS  PATH (
   P_ID INTEGER PRIMARY KEY     AUTOINCREMENT,
   PATH           TEXT          NOT NULL UNIQUE,
);

CREATE TABLE IF NOT EXISTS  ROOT (
   R_ID INTEGER PRIMARY KEY   AUTOINCREMENT,
   PATH           TEXT        NOT NULL,
   TAGS           TEXT(50),
   MID            INT         NOT NULL,
   FOREIGN KEY(MID) REFERENCES MACHINE(M_ID),
   UNIQUE (PATH, MID)
);

CREATE TABLE IF NOT EXISTS  MACHINE (
   M_ID INTEGER PRIMARY KEY     AUTOINCREMENT,
   NAME           TEXT          NOT NULL,
   IP             TEXT,
   PORT           INT,
   LASTACTIVE     DATETIME,
   SHARING        INT           NOT NULL  DEFAULT 0,
   UNIQUE (IP, PORT)
);

CREATE TABLE IF NOT EXISTS  KEY (
   K_ID INTEGER PRIMARY KEY     AUTOINCREMENT,
   KEY            TEXT(50)      NOT NULL,
   ADDED          DATETIME      NOT NULL,
   MID            INT,
   FOREIGN KEY(MID) REFERENCES MACHINE(M_ID),
   UNIQUE(KEY, MID)
);

